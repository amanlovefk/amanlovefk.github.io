---
title: "Paxos Simple 阅读笔记"
date: 2022-12-23T19:37:07+08:00
draft: false
---

## 问题定义

什么是共识算法（Consensus Algorithm）：

一个集合中的每个进程都能对某个变量的值作出提案。共识算法保证在提案（proposed）的值中只有一个被选中（chosen）。如果没有值被提出，那么就没有
值被选中。如果已经有值被选中了，那么进程能够学习（learn）到这个选中的值。

共识算法的活性要求（safety requirements）：

- 在提案的值中只有一个能被选中
- 仅选择一个值
- 一个进程只有在值被选中后才能知道这个被选中的值

活性要求保证了某个被提案的值最终会被选中，如果一个值别选中之后，一个进程最终能够学习到这个值。

Paxos 算法中包含三类角色，分别是：

- proposers, 提案者：负责对变量的值进行提案
- acceptors，接受者：负责对提案进行决策 —— 接受或者拒绝
- learners，学习者：在值被选中之后，进行学习

在具体实现中，一个进程可能扮演多种角色。

假设进程之间可以通过消息进行通信。Paxos 使用常见的，异步的，非拜占庭（non-Byzantine）模型：

- 进程以任意速度运行，可能会因为由于崩溃而失败，可能重启。因为，进程完全有可能在一个值被选中后失败，然后重启，所以必须借助持久化存储来保存
一些决策信息。
- 消息会花费任意上的时间，可能会重复，可能会丢失，但是绝不可能被破坏。

## 如何选择一个值

### 单个 Acceptor

最简单的方法是只有一个acceptor。一个 proposer 发送一个提案（proposal）给 acceptor，acceptor **接受（accepted）第一个收到的提案**。

只有一个 Acceptor，最显而易见的问题是：如果它挂掉了，那么共识就无法进行下去。

### 多个 Acceptor

很自然的，我们想到使用多个 Acceptor 来选择一个值。既然有多个 Acceptor，那么 Proposer 将提案发送给多个 Acceptor。只有当足够多
的Acceptor接受了某个值，那么它才算被选中了。这是多个 Acceptor 下的选择策略。那多少才足够呢？超过半数。1/3 行不行呢？如果有 1/3 的 Acceptor
选中了某个值，另外 2/3 选中了另外一个值，这样就选中两个值，不满足算法的活性要求。那么 1/2 行不行呢？也是同样的问题。如果超过半数，根据鸽笼原理，
不可能有两个大小超过半数而没有交集的集合选中不同的值。

假设我们共有 5 个Acceptor，分别为 S1, S2, S3, S4, S5. 其中：
- S1, S2, S3 选中了值 v1
- S2, S4, S5 选中了值 v2

集合 {S1, S2, S3} 和 {S2, S4, S5} 之间存在交集 {S2}。如果要达成共识，即 `v1 = v2` 的话，S2 只能选择一个值。

因为 S1, S3 和 S2 选择相同， S4, S5 和 S2 选择相同，所以 Acceptor 之间达成了共识。


